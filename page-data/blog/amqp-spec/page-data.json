{"componentChunkName":"component---src-pages-markdown-remark-frontmatter-slug-tsx","path":"/blog/amqp-spec/","result":{"data":{"markdownRemark":{"html":"<h2><strong>AMQP Specification Review (section 2.1 only)</strong></h2>\n<p class=\"text-time\">Initial Upload 2025-06-08 / Latest Modification 2025-06-08</p>\n<p><em><span class=\"text-purple\">Summary and review of the amqp spec section 2.1</span></em></p>\n<p>This review is based on the spec at <a href=\"https://www.rabbitmq.com/amqp-0-9-1-protocol\">https://www.rabbitmq.com/amqp-0-9-1-protocol</a>.</p>\n<p>It is only 40 pages written in plain english. (0-9-1)</p>\n<p>I tried to read through section 2.1 only (the main architecture part)</p>\n<h3>My overall thought on section 2.1</h3>\n<p>the most important bits:</p>\n<ol>\n<li>\n<p>It first seemed like everything is setup, but it is much more flexible at RUNTIME</p>\n<ul>\n<li>exchange is more or less controlled by the producer. (at least that seems like the best practice)</li>\n<li>queue is more or less controlled by the consumer. (at least that seems like the best practice)</li>\n<li>there are cases where one application creates a mq for itself and removed that queue on runtime.</li>\n</ul>\n</li>\n<li>\n<p>Transactions, cutting off connections</p>\n<ul>\n<li>there are weird details I found which is not necessarily obvious.</li>\n<li>transactions exist.</li>\n<li>when any error occurs, entire channel or connection is simply closed.</li>\n</ul>\n</li>\n</ol>\n<h3>Paraphrased Version</h3>\n<p>Below is what I paraphrased section 2.1 into a little bit easier format. ğŸŒŸ is my thoughts and I wanted to highlight them. It makes contents easier to digest.\nOnly the code + mermaid of this article is generated by gpt.</p>\n<h3>2.1.1 Main Entities</h3>\n<h3>2.1.1.1 The Message Queue</h3>\n<p>You can build queues various properties. Detailed options are not formally defined in AMQP.</p>\n<p>Examples of what you can build:</p>\n<ul>\n<li>store-and-forward queue => durable + shared\n<ul>\n<li>ğŸŒŸ durable + shared means queue is supposed to live forever + shared between queue consumers.</li>\n</ul>\n</li>\n<li>private reply queue => temporary + server-named + exclusive\n<ul>\n<li>ğŸŒŸ means queue can die at any moment + the amqp server generates random server name + cosumed by one consumer.</li>\n<li>ğŸŒŸ <code>channel.assertQueue('', { exclusive: true });</code> => <code>amq.gen-7sf9QJYV9x0yCwI8Qlq0vA</code></li>\n</ul>\n</li>\n<li>private subscription queue => temporary + server-named + exclusive</li>\n</ul>\n<h3>2.1.1.2 The Exchange</h3>\n<ul>\n<li>Exchanges === matching and routing engines</li>\n<li>Exchange type VS instance!\n<ul>\n<li>Exchange type?\n<ul>\n<li>fundamental types of routing needed. The CLASS, or blueprint of how the exchange should work.</li>\n</ul>\n</li>\n<li>Exchange instance?\n<ul>\n<li>default instances + the exchanges you initialize (ğŸŒŸ in rabbitmq management dashboard, you can see the default exchanges when you boot up.)</li>\n</ul>\n</li>\n<li>ğŸŒŸ type &#x26; instance here seems almost identical to OOP class &#x26; instance</li>\n</ul>\n</li>\n<li>Exchange is intended to add extensibility to AMQP for interoperability\n<ul>\n<li>ğŸŒŸ this means => <span class=\"text-skyblue\">Since we need to allow Java - JS - Python - multiple different environments to be communicable via AMQP (interoperability), we needed to create Exchange within AMQP protocol to handle complex situations.</span></li>\n</ul>\n</li>\n</ul>\n<h3>2.1.1.3 The Routing Key</h3>\n<ul>\n<li>routing key is <span class=\"text-orange\"><strong>only used within the server</strong></span>.</li>\n<li>it is used with different algorithms for different exchange types.</li>\n</ul>\n<h3>2.1.1.4 Analogy to Email</h3>\n<ul>\n<li>AMQP message â‰ˆ email message</li>\n<li>queue â‰ˆ mailbox</li>\n<li>consumer â‰ˆ mail client (gmail) that reads and delets email</li>\n<li>exchanges â‰ˆ MTA (mail transfer agent)</li>\n<li>routing key â‰ˆ email To:, Cc: address</li>\n<li>binding â‰ˆ MTA routing table</li>\n</ul>\n<p>the difference:</p>\n<ul>\n<li>amqp is for internal services (store messages within a server)</li>\n<li>VS email servers send emails here and there between servers.</li>\n</ul>\n<p>you need to setup explicit bridges for amqp - amqp server connection</p>\n<h3>2.1.2 Message Flow</h3>\n<h3>2.1.2.1 Message Life-cycle</h3>\n<p><svg aria-roledescription=\"flowchart-v2\" role=\"graphics-document document\" viewBox=\"0 0 1118.6015625 1949.96875\" style=\"max-width: 1118.6015625px;\" class=\"flowchart\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" id=\"mermaid-0\"><style>#mermaid-0{font-family:arial,sans-serif;font-size:16px;fill:#ccc;}@keyframes edge-animation-frame{from{stroke-dashoffset:0;}}@keyframes dash{to{stroke-dashoffset:0;}}#mermaid-0 .edge-animation-slow{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 50s linear infinite;stroke-linecap:round;}#mermaid-0 .edge-animation-fast{stroke-dasharray:9,5!important;stroke-dashoffset:900;animation:dash 20s linear infinite;stroke-linecap:round;}#mermaid-0 .error-icon{fill:#a44141;}#mermaid-0 .error-text{fill:#ddd;stroke:#ddd;}#mermaid-0 .edge-thickness-normal{stroke-width:1px;}#mermaid-0 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-0 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-0 .edge-thickness-invisible{stroke-width:0;fill:none;}#mermaid-0 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-0 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-0 .marker{fill:lightgrey;stroke:lightgrey;}#mermaid-0 .marker.cross{stroke:lightgrey;}#mermaid-0 svg{font-family:arial,sans-serif;font-size:16px;}#mermaid-0 p{margin:0;}#mermaid-0 .label{font-family:arial,sans-serif;color:#ccc;}#mermaid-0 .cluster-label text{fill:#F9FFFE;}#mermaid-0 .cluster-label span{color:#F9FFFE;}#mermaid-0 .cluster-label span p{background-color:transparent;}#mermaid-0 .label text,#mermaid-0 span{fill:#ccc;color:#ccc;}#mermaid-0 .node rect,#mermaid-0 .node circle,#mermaid-0 .node ellipse,#mermaid-0 .node polygon,#mermaid-0 .node path{fill:#1f2020;stroke:#ccc;stroke-width:1px;}#mermaid-0 .rough-node .label text,#mermaid-0 .node .label text,#mermaid-0 .image-shape .label,#mermaid-0 .icon-shape .label{text-anchor:middle;}#mermaid-0 .node .katex path{fill:#000;stroke:#000;stroke-width:1px;}#mermaid-0 .rough-node .label,#mermaid-0 .node .label,#mermaid-0 .image-shape .label,#mermaid-0 .icon-shape .label{text-align:center;}#mermaid-0 .node.clickable{cursor:pointer;}#mermaid-0 .root .anchor path{fill:lightgrey!important;stroke-width:0;stroke:lightgrey;}#mermaid-0 .arrowheadPath{fill:lightgrey;}#mermaid-0 .edgePath .path{stroke:lightgrey;stroke-width:2.0px;}#mermaid-0 .flowchart-link{stroke:lightgrey;fill:none;}#mermaid-0 .edgeLabel{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-0 .edgeLabel p{background-color:hsl(0, 0%, 34.4117647059%);}#mermaid-0 .edgeLabel rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-0 .labelBkg{background-color:rgba(87.75, 87.75, 87.75, 0.5);}#mermaid-0 .cluster rect{fill:hsl(180, 1.5873015873%, 28.3529411765%);stroke:rgba(255, 255, 255, 0.25);stroke-width:1px;}#mermaid-0 .cluster text{fill:#F9FFFE;}#mermaid-0 .cluster span{color:#F9FFFE;}#mermaid-0 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:arial,sans-serif;font-size:12px;background:hsl(20, 1.5873015873%, 12.3529411765%);border:1px solid rgba(255, 255, 255, 0.25);border-radius:2px;pointer-events:none;z-index:100;}#mermaid-0 .flowchartTitleText{text-anchor:middle;font-size:18px;fill:#ccc;}#mermaid-0 rect.text{fill:none;stroke-width:0;}#mermaid-0 .icon-shape,#mermaid-0 .image-shape{background-color:hsl(0, 0%, 34.4117647059%);text-align:center;}#mermaid-0 .icon-shape p,#mermaid-0 .image-shape p{background-color:hsl(0, 0%, 34.4117647059%);padding:2px;}#mermaid-0 .icon-shape rect,#mermaid-0 .image-shape rect{opacity:0.5;background-color:hsl(0, 0%, 34.4117647059%);fill:hsl(0, 0%, 34.4117647059%);}#mermaid-0 .label-icon{display:inline-block;height:1em;overflow:visible;vertical-align:-0.125em;}#mermaid-0 .node .label-icon path{fill:currentColor;stroke:revert;stroke-width:revert;}#mermaid-0 :root{--mermaid-font-family:arial,sans-serif;}</style><g><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mermaid-0_flowchart-v2-pointEnd\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 0 L 10 5 L 0 10 z\"></path></marker><marker orient=\"auto\" markerHeight=\"8\" markerWidth=\"8\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"4.5\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mermaid-0_flowchart-v2-pointStart\"><path style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 0 5 L 10 10 L 10 0 z\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"11\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mermaid-0_flowchart-v2-circleEnd\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5\" refX=\"-1\" viewBox=\"0 0 10 10\" class=\"marker flowchart-v2\" id=\"mermaid-0_flowchart-v2-circleStart\"><circle style=\"stroke-width: 1; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" r=\"5\" cy=\"5\" cx=\"5\"></circle></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"12\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mermaid-0_flowchart-v2-crossEnd\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><marker orient=\"auto\" markerHeight=\"11\" markerWidth=\"11\" markerUnits=\"userSpaceOnUse\" refY=\"5.2\" refX=\"-1\" viewBox=\"0 0 11 11\" class=\"marker cross flowchart-v2\" id=\"mermaid-0_flowchart-v2-crossStart\"><path style=\"stroke-width: 2; stroke-dasharray: 1, 0;\" class=\"arrowMarkerPath\" d=\"M 1,1 l 9,9 M 10,1 l -9,9\"></path></marker><g class=\"root\"><g class=\"clusters\"><g data-look=\"classic\" id=\"Transaction\" class=\"cluster\"><rect height=\"232\" width=\"604.1796875\" y=\"1709.96875\" x=\"506.421875\" style=\"\"></rect><g transform=\"translate(767.01171875, 1709.96875)\" class=\"cluster-label\"><foreignObject height=\"24\" width=\"83\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>Transaction</p></span></div></foreignObject></g></g></g><g class=\"edgePaths\"><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_A_B_0\" d=\"M512.944,62L506.785,66.167C500.627,70.333,488.309,78.667,482.151,86.333C475.992,94,475.992,101,475.992,104.5L475.992,108\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_B_C_0\" d=\"M475.992,190L475.992,194.167C475.992,198.333,475.992,206.667,475.992,214.333C475.992,222,475.992,229,475.992,232.5L475.992,236\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_C_D_0\" d=\"M475.992,318L475.992,322.167C475.992,326.333,475.992,334.667,476.062,342.417C476.133,350.167,476.273,357.334,476.344,360.917L476.414,364.501\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_D_E1_0\" d=\"M425.852,551.954L414.63,566.477C403.408,581,380.964,610.047,369.742,632.07C358.52,654.094,358.52,669.094,358.52,676.594L358.52,684.094\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_D_E2_0\" d=\"M527.132,551.954L538.188,566.477C549.243,581,571.354,610.047,582.409,630.07C593.465,650.094,593.465,661.094,593.465,666.594L593.465,672.094\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_E2_F_0\" d=\"M593.465,754.094L593.465,758.26C593.465,762.427,593.465,770.76,593.465,778.427C593.465,786.094,593.465,793.094,593.465,796.594L593.465,800.094\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_F_G_0\" d=\"M593.465,882.094L593.465,886.26C593.465,890.427,593.465,898.76,593.535,906.511C593.605,914.261,593.746,921.428,593.816,925.011L593.886,928.595\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_G_H1_0\" d=\"M531.795,1076.909L506.694,1093.354C481.593,1109.798,431.39,1142.688,406.289,1164.633C381.188,1186.578,381.188,1197.578,381.188,1203.078L381.188,1208.578\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_H1_I_0\" d=\"M381.188,1290.578L381.188,1294.745C381.188,1298.911,381.188,1307.245,381.188,1314.911C381.188,1322.578,381.188,1329.578,381.188,1333.078L381.188,1336.578\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_G_H2_0\" d=\"M657.146,1075.896L683.397,1092.51C709.647,1109.124,762.148,1142.351,788.398,1164.465C814.648,1186.578,814.648,1197.578,814.648,1203.078L814.648,1208.578\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_I_J_0\" d=\"M381.188,1394.578L381.188,1398.745C381.188,1402.911,381.188,1411.245,381.258,1418.995C381.328,1426.745,381.469,1433.912,381.539,1437.495L381.609,1441.079\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_J_K1_0\" d=\"M318.602,1573.383L286.247,1589.981C253.893,1606.578,189.185,1639.773,156.831,1662.538C124.477,1685.302,124.477,1697.635,124.477,1709.302C124.477,1720.969,124.477,1731.969,124.477,1737.469L124.477,1742.969\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_J_K2_0\" d=\"M381.688,1636.469L381.604,1642.552C381.521,1648.635,381.354,1660.802,381.271,1673.052C381.188,1685.302,381.188,1697.635,381.188,1709.302C381.188,1720.969,381.188,1731.969,381.188,1737.469L381.188,1742.969\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_A_L1_0\" d=\"M678.453,51.063L725.288,57.052C772.122,63.042,865.792,75.021,912.626,91.677C959.461,108.333,959.461,129.667,959.461,151C959.461,172.333,959.461,193.667,959.461,215C959.461,236.333,959.461,257.667,959.461,279C959.461,300.333,959.461,321.667,959.461,356.008C959.461,390.349,959.461,437.698,959.461,487.047C959.461,536.396,959.461,587.745,959.461,626.086C959.461,664.427,959.461,689.76,959.461,713.094C959.461,736.427,959.461,757.76,959.461,779.094C959.461,800.427,959.461,821.76,959.461,843.094C959.461,864.427,959.461,885.76,959.461,917.801C959.461,949.841,959.461,992.589,959.461,1037.336C959.461,1082.083,959.461,1128.831,959.461,1164.871C959.461,1200.911,959.461,1226.245,959.461,1249.578C959.461,1272.911,959.461,1294.245,959.461,1313.578C959.461,1332.911,959.461,1350.245,959.461,1367.578C959.461,1384.911,959.461,1402.245,959.461,1431.027C959.461,1459.81,959.461,1500.042,959.461,1542.273C959.461,1584.505,959.461,1628.737,959.461,1657.02C959.461,1685.302,959.461,1697.635,959.461,1707.302C959.461,1716.969,959.461,1723.969,959.461,1727.469L959.461,1730.969\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_J_L2_0\" d=\"M447.358,1570.798L484.702,1587.827C522.046,1604.855,596.734,1638.912,634.078,1662.107C671.422,1685.302,671.422,1697.635,671.422,1707.302C671.422,1716.969,671.422,1723.969,671.422,1727.469L671.422,1730.969\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_L1_L3_0\" d=\"M959.461,1812.969L959.461,1817.135C959.461,1821.302,959.461,1829.635,957.637,1837.375C955.813,1845.115,952.165,1852.26,950.341,1855.833L948.517,1859.406\"></path><path marker-end=\"url(#mermaid-0_flowchart-v2-pointEnd)\" style=\"\" class=\"edge-thickness-normal edge-pattern-solid edge-thickness-normal edge-pattern-solid flowchart-link\" id=\"L_L2_L3_0\" d=\"M671.422,1812.969L671.422,1817.135C671.422,1821.302,671.422,1829.635,693.643,1838.221C715.864,1846.806,760.306,1855.644,782.528,1860.063L804.749,1864.482\"></path></g><g class=\"edgeLabels\"><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g transform=\"translate(358.51953125, 639.09375)\" class=\"edgeLabel\"><g transform=\"translate(-10.2265625, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"20.453125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>No</p></span></div></foreignObject></g></g><g transform=\"translate(593.46484375, 639.09375)\" class=\"edgeLabel\"><g transform=\"translate(-13.0546875, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"26.109375\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>Yes</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g transform=\"translate(381.1875, 1175.578125)\" class=\"edgeLabel\"><g transform=\"translate(-13.0546875, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"26.109375\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>Yes</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g transform=\"translate(814.6484375, 1175.578125)\" class=\"edgeLabel\"><g transform=\"translate(-10.2265625, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"20.453125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>No</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g transform=\"translate(124.4765625, 1672.96875)\" class=\"edgeLabel\"><g transform=\"translate(-13.3359375, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"26.671875\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>Ack</p></span></div></foreignObject></g></g><g transform=\"translate(381.1875, 1672.96875)\" class=\"edgeLabel\"><g transform=\"translate(-18.2265625, -12)\" class=\"label\"><foreignObject height=\"24\" width=\"36.453125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"><p>Nack</p></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g><g class=\"edgeLabel\"><g transform=\"translate(0, 0)\" class=\"label\"><foreignObject height=\"0\" width=\"0\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" class=\"labelBkg\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"edgeLabel\"></span></div></foreignObject></g></g></g><g class=\"nodes\"><g transform=\"translate(552.8515625, 35)\" id=\"flowchart-A-0\" class=\"node default\"><rect height=\"54\" width=\"251.203125\" y=\"-27\" x=\"-125.6015625\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-95.6015625, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"191.203125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>Producer creates Message</p></span></div></foreignObject></g></g><g transform=\"translate(475.9921875, 151)\" id=\"flowchart-B-1\" class=\"node default\"><rect height=\"78\" width=\"237.4375\" y=\"-39\" x=\"-118.71875\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-88.71875, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"177.4375\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ“ Adds Content +<br></br>Properties + Routing Info</p></span></div></foreignObject></g></g><g transform=\"translate(475.9921875, 279)\" id=\"flowchart-C-2\" class=\"node default\"><rect height=\"78\" width=\"216.96875\" y=\"-39\" x=\"-108.484375\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-78.484375, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"156.96875\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ“® Sends Message to<br></br>Exchange</p></span></div></foreignObject></g></g><g transform=\"translate(475.9921875, 485.046875)\" id=\"flowchart-D-3\" class=\"node default\"><polygon transform=\"translate(-117.046875,117.046875)\" class=\"label-container\" points=\"117.046875,0 234.09375,-117.046875 117.046875,-234.09375 0,-117.046875\"></polygon><g transform=\"translate(-78.046875, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"156.09375\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ”€ Can the Exchange<br></br>Route it?</p></span></div></foreignObject></g></g><g transform=\"translate(358.51953125, 715.09375)\" id=\"flowchart-E1-4\" class=\"node default\"><rect height=\"54\" width=\"190.265625\" y=\"-27\" x=\"-95.1328125\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-65.1328125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"130.265625\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ—‘ï¸ Drop or Return</p></span></div></foreignObject></g></g><g transform=\"translate(593.46484375, 715.09375)\" id=\"flowchart-E2-5\" class=\"node default\"><rect height=\"78\" width=\"179.625\" y=\"-39\" x=\"-89.8125\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-59.8125, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"119.625\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>â¡ï¸ Route to One<br></br>or More Queues</p></span></div></foreignObject></g></g><g transform=\"translate(593.46484375, 843.09375)\" id=\"flowchart-F-6\" class=\"node default\"><rect height=\"78\" width=\"202.71875\" y=\"-39\" x=\"-101.359375\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-71.359375, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"142.71875\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ“¥ Message Arrives<br></br>in Queue</p></span></div></foreignObject></g></g><g transform=\"translate(593.46484375, 1035.3359375)\" id=\"flowchart-G-7\" class=\"node default\"><polygon transform=\"translate(-103.2421875,103.2421875)\" class=\"label-container\" points=\"103.2421875,0 206.484375,-103.2421875 103.2421875,-206.484375 0,-103.2421875\"></polygon><g transform=\"translate(-64.2421875, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"128.484375\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ‘€ Is a Consumer<br></br>Available?</p></span></div></foreignObject></g></g><g transform=\"translate(381.1875, 1251.578125)\" id=\"flowchart-H1-8\" class=\"node default\"><rect height=\"78\" width=\"146.25\" y=\"-39\" x=\"-73.125\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-43.125, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"86.25\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ“¨ Deliver<br></br>Immediately</p></span></div></foreignObject></g></g><g transform=\"translate(814.6484375, 1251.578125)\" id=\"flowchart-H2-9\" class=\"node default\"><rect height=\"78\" width=\"201.8125\" y=\"-39\" x=\"-100.90625\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-70.90625, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"141.8125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ’¾ Store in Memory<br></br>or Disk</p></span></div></foreignObject></g></g><g transform=\"translate(381.1875, 1367.578125)\" id=\"flowchart-I-10\" class=\"node default\"><rect height=\"54\" width=\"230.28125\" y=\"-27\" x=\"-115.140625\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-85.140625, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"170.28125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ“¬ Deliver to Consumer</p></span></div></foreignObject></g></g><g transform=\"translate(381.1875, 1540.2734375)\" id=\"flowchart-J-11\" class=\"node default\"><polygon transform=\"translate(-95.6953125,95.6953125)\" class=\"label-container\" points=\"95.6953125,0 191.390625,-95.6953125 95.6953125,-191.390625 0,-95.6953125\"></polygon><g transform=\"translate(-68.6953125, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"137.390625\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>âœ… Consumer Ack?</p></span></div></foreignObject></g></g><g transform=\"translate(124.4765625, 1773.96875)\" id=\"flowchart-K1-12\" class=\"node default\"><rect height=\"54\" width=\"232.953125\" y=\"-27\" x=\"-116.4765625\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-86.4765625, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"172.953125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ§¹ Remove from Queue</p></span></div></foreignObject></g></g><g transform=\"translate(381.1875, 1773.96875)\" id=\"flowchart-K2-13\" class=\"node default\"><rect height=\"54\" width=\"180.46875\" y=\"-27\" x=\"-90.234375\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-60.234375, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"120.46875\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>â›” Reject - Nack</p></span></div></foreignObject></g></g><g transform=\"translate(959.4609375, 1773.96875)\" id=\"flowchart-L1-14\" class=\"node default\"><rect height=\"78\" width=\"216.078125\" y=\"-39\" x=\"-108.0390625\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-78.0390625, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"156.078125\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ“¦ Grouped Producer<br></br>Messages</p></span></div></foreignObject></g></g><g transform=\"translate(671.421875, 1773.96875)\" id=\"flowchart-L2-15\" class=\"node default\"><rect height=\"78\" width=\"260\" y=\"-39\" x=\"-130\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-100, -24)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"48\" width=\"200\"><div style=\"display: table; white-space: break-spaces; line-height: 1.5; max-width: 200px; text-align: center; width: 200px;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>ğŸ§¾ Grouped Consumer Acks</p></span></div></foreignObject></g></g><g transform=\"translate(932.9140625, 1889.96875)\" id=\"flowchart-L3-16\" class=\"node default\"><rect height=\"54\" width=\"248.484375\" y=\"-27\" x=\"-124.2421875\" style=\"\" class=\"basic label-container\"></rect><g transform=\"translate(-94.2421875, -12)\" style=\"\" class=\"label\"><rect></rect><foreignObject height=\"24\" width=\"188.484375\"><div style=\"display: table-cell; white-space: nowrap; line-height: 1.5; max-width: 200px; text-align: center;\" xmlns=\"http://www.w3.org/1999/xhtml\"><span class=\"nodeLabel\"><p>âœ… Commit or âŒ Rollback</p></span></div></foreignObject></g></g></g></g></g></svg></p>\n<ul>\n<li>ğŸŒŸ I was surprised there was transaction feature in amqp.</li>\n</ul>\n<h3>2.1.2.2 What The Producer Sees</h3>\n<ul>\n<li>messages never goes directly to queues.</li>\n<li>messages should always go through exchange(s).</li>\n<li>producer only sees exchange(s).</li>\n</ul>\n<h3>2.1.2.3 What The Consumer Sees</h3>\n<ul>\n<li>consumer sees a lot more than a simple email consumer.\n<ul>\n<li>can create or destroy mqs</li>\n<li>can make bindings. (bindings define how the mq is filled)</li>\n<li>select different exchanges</li>\n</ul>\n</li>\n</ul>\n<h3>2.1.2.4 Automatic Mode</h3>\n<p>there is default mode since amqp don't need to be all this complicated in most cases:</p>\n<ul>\n<li>default exchange exists</li>\n<li>default routing logic: routing key is mapped to the queue of the same name.</li>\n</ul>\n<h3>2.1.3 Exchanges</h3>\n<h3>2.1.3.1 Types of Exchange</h3>\n<ul>\n<li>direct: routing key exact match</li>\n<li>topic: routing key pattern match (*, #)\n<ul>\n<li>ğŸŒŸ * is any single word and # is zero or multiple words</li>\n</ul>\n</li>\n</ul>\n<p>there are others specified in \"Functional Specification\" Section</p>\n<h3>2.1.3.2 Exchange Life-cycle</h3>\n<ul>\n<li>default exchanges are not removeable.</li>\n<li>there is no \"create exchange\" but rather \"declare exchange\" which means something similar to what we do in dbs: \"CREATE 'x' IF NOT EXISTS\"</li>\n<li>it is uncommon to remove exchanges.</li>\n</ul>\n<h3>2.1.4 Message Queues</h3>\n<h3>2.1.4.1 Message Queue Properties</h3>\n<ul>\n<li>name:\n<ul>\n<li>bp is to use random name generated by server if a single application is using it for its own purpose</li>\n<li>otherwise, set it up front, cohering to other applications which use the same queues.</li>\n</ul>\n</li>\n<li>exclusive:\n<ul>\n<li>current connection only</li>\n<li>deleted when connection closes</li>\n</ul>\n</li>\n<li>durable:\n<ul>\n<li>queue remains present and active when server restarts.</li>\n<li>might lose message when server restarts though!</li>\n</ul>\n</li>\n</ul>\n<h3>2.1.4.2 Queue Life-cycles</h3>\n<p>two main types + possible other types.</p>\n<ul>\n<li>Durable MQ: lives even though nobody is consuming</li>\n<li>Temporary MQ: deleted when consumer disconnects</li>\n<li>Shared MQ: deleted when last consumer disconnects</li>\n<li>x MQ: might be other patterns as well.</li>\n</ul>\n<h3>2.1.5 Bindings</h3>\n<ul>\n<li>bindings = logic for exchange to mq</li>\n<li>constructed from the client application (one owning the mq)</li>\n</ul>\n<h3>2.1.5.1 Constructing a Shared Queue</h3>\n<ul>\n<li>wip</li>\n</ul>\n<h3>2.1.5.2 Constructing a Reply Queue</h3>\n<ul>\n<li>wip</li>\n</ul>\n<h3>2.1.5.3 Constructing a Pub-Sub Subscription Queue</h3>\n<ul>\n<li>wip</li>\n</ul>","frontmatter":{"date":"June 08, 2025","slug":"/blog/amqp-spec","title":"AMQP Specification Review (section 2.1 only)","subtitle":"Summary and review of the important bits of the amqp spec's section 2.1"}}},"pageContext":{"id":"201b8d77-c2af-5a19-89f3-f210fcc2cbd1","frontmatter__slug":"/blog/amqp-spec","__params":{"frontmatter__slug":"blog"}}},"staticQueryHashes":["1865044719","2228436175","326441978"],"slicesMap":{}}